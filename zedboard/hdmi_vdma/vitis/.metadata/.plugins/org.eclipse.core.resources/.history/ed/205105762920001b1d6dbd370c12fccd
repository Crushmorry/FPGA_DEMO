//#include "xparameters.h"
//#include "xaxivdma.h"
////#define VDMA_ID XPAR_AXIVDMA_0_DEVICE_ID
////XAxiVdma vdma;
////XAxiVdma_Config *axiVdma;
//
//#define VDMA_BASEADDR XPAR_AXIVDMA_0_BASEADDR  XPAR_AXI_VDMA_0_BASEADDR
//#define VIDEO_BASEADDR 0x2000000
//#define H_STRIDE 1280
//#define H_ACTIVE 1280
//#define V_ACTIVE 720
//int main()
//{
////	axiVdma = XAxiVdma_LookupConfig(VDMA_ID);
////	XAxiVdma_CfgInitialize(&vdma, axiVdma, axiVdma->BaseAddress);
//	Xil_Out32(VDMA_BASEADDR + 0x000, 0x00000003);
//	Xil_Out32(VDMA_BASEADDR + 0x05c, VIDEO_BASEADDR);
//	Xil_Out32(VDMA_BASEADDR + 0x058, H_STRIDE*3);
//	Xil_Out32(VDMA_BASEADDR + 0x054, H_ACTIVE*3);
//	Xil_Out32(VDMA_BASEADDR + 0x050, V_ACTIVE*3);
//	return 0;
//}

#include <stdio.h>
#include "xparameters.h"
#include "xil_io.h"

int main()
   {
        init_platform();

        xil_printf("----------The test is start......----------\n\r");

        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0x30, 0x4); //reset   S2MM VDMA Control Register
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0x30, 0x8); //genlock
            Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0xAC, 0x08000000);//S2MM Start Addresses
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0xAC+4, 0x0A000000);
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0xAC+8, 0x09000000);
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0xA4, 1920*3);//S2MM Horizontal Size
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0xA8, 0x01002000);//S2MM Frame Delay and Stride
         Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0x30, 0x3);//S2MM VDMA Control Register
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0xA0, 1080);//S2MM Vertical Size  start an S2MM transfer

        //AXI VDMA1
         Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0x0, 0x4); //reset   MM2S VDMA Control Register
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0x0, 0x8); //gen-lock

        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0x5C,   0x08000000);   //MM2S Start Addresses
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0x5C+4, 0x0A000000);
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0x5C+8, 0x09000000);
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0x54, 1920*3);//MM2S HSIZE Register
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0x58, 0x01002000);//S2MM FRMDELAY_STRIDE Register 1920*3=5760 对齐之后为8192=0x2000
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0x0, 0x03);//MM2S VDMA Control Register
        Xil_Out32(XPAR_AXIVDMA_0_BASEADDR + 0x50, 1080);//MM2S_VSIZE    启动传输

        cleanup_platform();
        return 0;
    }
